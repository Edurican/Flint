name: Move Jira to In Progress
on:
  create:
    branches:
      - '**'
permissions:
  contents: read
jobs:
  update-jira-status:
    runs-on: ubuntu-latest
    if: github.ref_type == 'branch'
    steps:
      - name: Extract Jira ticket number
        id: extract
        run: |
          BRANCH_NAME="${{ github.ref_name }}"
          if [[ $BRANCH_NAME =~ ^(FLINT-[0-9]+) ]]; then
            echo "ticket=${BASH_REMATCH[1]}" >> $GITHUB_OUTPUT
            echo "Found ticket: ${BASH_REMATCH[1]}"
          else
            echo "No Jira ticket found in branch name"
            exit 0
          fi

      - name: Login to Jira
        if: steps.extract.outputs.ticket
        uses: atlassian/gajira-login@v3
        env:
          JIRA_BASE_URL: ${{ secrets.JIRA_BASE_URL }}
          JIRA_API_TOKEN: ${{ secrets.JIRA_API_TOKEN }}
          JIRA_USER_EMAIL: ${{ secrets.JIRA_USER_EMAIL }}

      - name: Transition to In Progress
        if: steps.extract.outputs.ticket
        uses: atlassian/gajira-transition@v3
        with:
          issue: ${{ steps.extract.outputs.ticket }}
          transition: "진행 중"